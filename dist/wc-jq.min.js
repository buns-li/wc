!function(){"use strict";function t(t){return function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}}function e(t,e){this.cmp=e,this.evt=t,this.subs={},this.times={},this.cb=null,this.sublen=0}function n(t){this._trans={},this._prev=null,this._state=t}function i(t,e,n){this.id=t,this.opts=e||{},this.fac=n,this.state=0}function o(t,e,n){var i=void 0,o=void 0,r=void 0,s=null,a=0;n||(n={});var c=function(){a=!1===n.leading?0:(new Date).getTime(),s=null,r=t.apply(i,o),s||(i=o=null)};return function(){var u=(new Date).getTime();a||!1!==n.leading||(a=u);var f=e-(u-a);return i=this,o=arguments,f<=0||f>e?(s&&(clearTimeout(s),s=null),a=u,r=t.apply(i,o),s||(i=o=null)):s||!1===n.trailing||(s=setTimeout(c,f)),r}}function r(t){var e=this.ctx||"#"+this.id;return k(e?t?t.nodeType?t:e+" "+t:e:t)}function s(t,e){e=e||0;var n=r(t);if(!n)return!1;var i=n.offset(),o=i.left-e,s=i.top-e,a=n.width()+o+e,c=n.height()+s+e,u=r(window),f=u.scrollLeft(),l=u.scrollTop(),d=f+u.width(),h=l+u.height();return!(o>d||f>a||s>h||l>c)}function a(t,e){function n(t,e){var i=t.sheet,o=void 0;if(I)i&&(o=!0);else if(i)try{i.cssRules&&(o=!0)}catch(t){"NS_ERROR_DOM_SECURITY_ERR"===t.name&&(o=!0)}setTimeout(function(){o?e&&e():n(t,e)},20)}var i=void 0;"string"==typeof t?(i=t,t={callback:e}):i=t.url;var o=i&&/\.css(?:\?|$)/i.test(i),r=document.createElement(o?"link":"script");r.charset="utf-8",r.crossOrigin=!0,o?r.rel="stylesheet":(r.async=!0,r.type=t.type||"text/javascript"),function(t,e,i,o){function r(n){t.onload=t.onerror=t.onreadystatechange=null,t=null,e&&e(n)}var s="onload"in t;!o||!I&&s?s?(t.onload=r,t.onerror=function(){r({uri:i,node:t})}):t.onreadystatechange=function(){/loaded|complete/.test(t.readyState)&&r()}:setTimeout(function(){n(t,e)},1)}(r,t.callback,i||"inline-script",o),o?r.href=i:r.src=i,A?E.insertBefore(r,A):E.appendChild(r)}function c(t,e){var n=t.lastIndexOf("."),i=t.substring(n+1,t.length),o=void 0;if("css"===i||"js"===i){var r=L.Deferred();return a(t,function(t){return t?r.reject(t):r.resolve("ok")}),o=r.promise(),o.catch=o.error||o.fail,o}var s=L.extend({url:t},e);return o=$.ajax(s),o.catch=o.error||o.fail,o}function u(){var t=void 0,e=void 0,n=[];if(d&&d.length)for(var o=d.length;o--;)2!==(t=l[d[o]]).state?(0===t.state&&t.ctx&&t.http&&s&&s(t.ctx)&&n.push(t.id),e=!1):(i.load(t),d.splice(o,1),e=!0);else for(var r in l)if("__env__"!==r)switch((t=l[r]).state){case 0:0===t.state&&t.ctx&&t.http&&s&&s(t.ctx)&&n.push(t.id);break;case 1:d.push(t.id),e=!1;break;case 2:i.load(t);case 3:default:e=!0}if(!n.length)return e;var a=n.length;if(h.combo){for(var c=h.combo(n,"js");a--;)l[n[a]].state=1;a=n.length,i.prototype.http(c).then(function(){for(;a--;)i.load(l[n[a]])}).catch(function(){for(;a--;)l[n[a]].state=4}),c=h.combo(n,"css"),i.prototype.http(c).catch(function(t){return console.log(t)})}return e}var f={},l={},d=[],h={},p=["$","http","tpl","anim","cache","util"],v=["ready","onLoad","onScroll","onResize","beforeLeave"],m=Array.isArray||t("Array"),_=t("Function"),b=t("Object"),y={},g={on:function(t,e,n){if(!t||!e)return this;var i=e;if(n){var o=!1,r=e;i=function(){g.off(t,i),o||(o=!0,r.apply(this,arguments))}}for(var s=(t=t.split(",")).length;s--;)(y[t[s]]||(y[t[s]]=[])).push(i);return this},off:function(t,e){if(!t&&!e)return y={},this;var n=y[t],i=void 0;if(n&&(i=n.length))if(e)for(;i--;)n[i]===e&&n.splice(i,1);else delete y[t];return this},emit:function(t,e,n){if(t){m(e)||(e=[e]);var i=void 0,o=void 0;if(m(t)){for(var r=0,s=t.length;r<s;r++)if((i=y[t[r]])&&(o=i.length))for(n&&n.sub(t[r],o),i=i.slice();o--;)n&&n.hndIdx(o),i[o].apply(null,e)}else{if(!(i=y[t])||!(o=i.length))return;for(n&&n.sub(t,o),i=i.slice();o--;)n&&n.hndIdx(o),i[o].apply(null,e)}}}},w={},x={};e.prototype={constructor:e,addSub:function(t,e){var n=this.subs[t];n?n.push(e):this.subs[t]=[e]},record:function(t,e){x.c=t,x.p=e,x.t=(new Date).getTime();var n=this.times[x.t]={__oklen:0};return{sub:function(t,e){x.s=t,n[t]||(n[t]={len:e||0,datas:[]})},hndIdx:function(t){x.hndIdx=t}}}},e.signal=function(t,e){if(!t)return x.c+"::"+x.p+"::"+x.t+"::"+x.s+"::"+x.hndIdx;var n=t.split("::"),i=w[n[1]];if(i){var o=i.times[n[2]];if(o){var r=o[n[3]];if(r&&(r.datas[n[4]]=e,r.len===r.datas.length&&(o.__oklen+=1),o.__oklen===i.sublen)){if(i.cb){var s=[];delete o.__oklen;for(var a in o)delete o[a].len,s.push(o[a]);i.cb.apply(null,s)}i.times[n[2]]=null}}}},e.get=function(t){return t?w[t]:null},e.set=function(t){t&&(w[i.nameFn(t.cmp,t.evt)]=t)},n.prototype={constructor:n,trans:function(t){var e=this._trans,n=this._state===t.from?this._state:t.from;return(e[n]||(e[n]={}))[t.name]=t,this},transit:function(){var t=Array.prototype.slice.apply(arguments),e=this._trans[this._state];if(!e)throw new Error("当前组件不具备从状态-"+this._state+"开始的变迁");var n=e[t.shift()];if(n){var i=n.from;if("*"!==i&&i!==this._state&&!i.includes(this._state))throw new Error("组件不能从"+this._state+"转换至"+n.to+"状态");this._prev=this._state,n.before&&n.before.apply(null,t),this._state=n.to,n.after&&n.after.apply(null,t)}}};i.nameFn=function(t,e){return t+"_"+e},i.prototype={constructor:i,hook:function(t,n){if(!v.includes(t))return this;var o=i.nameFn(this.id,t);g.on(o,n.bind(i.eventRicher),"ready"===t||"onLoad"===t);var r=e.get(i.nameFn("__env__",t));return r||e.set(r=new e(t,"__env__")),r.addSub(this.id,t),this},on:function(t,e){return g.on(i.nameFn(this.id,t),e.bind(i.eventRicher)),this},pub:function(t,n,o){var r=this,s=i.nameFn(this.id,t),a=e.get(s);if(!a)return this;var c=a.subs,u=0,d=void 0,p=void 0,v=void 0,m=void 0,_=void 0;if(!c)return this;var b=a.record(s,this.id),y=[];for(d in c)if(m=l[d]){if(p=c[d])if(p.length){if(v=p.length,u+=v,0!==m.state&&1!==m.state||"continue"!==function(){if(0===m.state&&y.push(d),!(_=f[d]))return"continue";for(;v--;){var e=_[p[v]];if(e){for(var o=!1,s=e.length;s--;){var a=e[s];a.cmp===r.id&&a.evt===t&&(a.data=n,o=!0)}o||e.push({cmp:r.id,evt:t,data:n})}else e[p[v]]=[{cmp:r.id,evt:t,data:n}]}if(!y.length||r.http)return"continue";var c=y.length;if(h.combo){for(var u=h.combo(y,"js");c--;)l[y[c]].state=1;c=y.length,r.http(u).then(function(){for(;c--;)i.load(l[y[c]])}).catch(function(){for(;c--;)l[y[c]].state=4}),u=h.combo(y,"css"),r.http(u).catch(function(t){return console.log(t)})}return"continue"}())for(;v--;)g.emit(i.nameFn(d,p[v]),n,b)}else delete c[d]}else delete c[d];a.sublen=u,a.cb=o},callSelf:function(t,e){return g.emit(i.nameFn(this.id,t),e),this}},i.eventRicher={pause:function(){return e.signal()},resume:function(t,n){e.signal(t,n)}},i.load=function(t){!t.fsm&&(t.fsm=function(t){return new n(t)}),t.fac.call(t),t.state=3;var o=f[t.id],r=void 0,s=void 0,a=void 0,c=void 0,u=void 0;for(var l in o)if((r=o[l])&&r.length)for(s=r.length;s--;)if(a=r[s],c=e.get(u=i.nameFn(a.cmp,a.evt))){var d=c.record(u,a.cmp);g.emit(i.nameFn(t.id,l),a.data,d)}else r.splice(s,1);else delete o[l]},l.__env__=new i("__env__",null,function(){}),l.__env__.state=2;var S={ctor:function(t,e){return this.cmp=l[t]||(l[t]=new i(t)),!0!==e&&void 0!==e||(this.cmp.ctx="#"+t),this},at:function(t,e){var n=this;if(!n.cmp)return n;var o=n.cmp;if(1===arguments.length&&b(arguments[0])&&(e=t,t=null),t)if(m(t)){var r=t.length-1;for(o.ctx=t[r];r--;){n.copy=n.copy||[];var s=o.id+"_v"+r;n.copy.push(l[s]=new i(s,e||o.options,o.factory))}}else o.ctx=t,e&&(o.opts=o.opts?Object.assign(o.opts,e):e);else o.ctx="#"+o.id,o.opts=e;return n},sub:function(t,n,o){m(n)||(n=[n]);for(var r=void 0,s=n.length;s--;)if(r=e.get(i.nameFn(t,n[s]))){if(r.addSub(o,this.cmp.id),this.copy&&this.copy.length)for(var a=this.copy.length;a--;)r.addSub(o,this.copy[a].id)}else{if((r=new e(n[s],t)).addSub(this.cmp.id,o),this.copy&&this.copy.length)for(var c=this.copy.length;c--;)r.addSub(this.copy[c].id,o);e.set(r)}return this}};S.ctor.prototype=S;var j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T=window.wc=function(t,e){return S.ctor(t,e)};"function"==typeof define?define.amd?define("wc",[],function(){return T}):define.cmd&&define(function(t,e,n){n.exports=T}):"undefined"!=typeof module&&"object"===("undefined"==typeof exports?"undefined":j(exports))&&(module.exports=T),T.version="0.0.1",T.define=function(t,e,n){if(t){var o=l[t];!n&&_(e)&&(n=e,e=null),o?(o.fac=n,e&&(o.opts=o.opts?Object.assign(o.opts,e):e)):o=l[t]=new i(t,e,n),o.state=2}},T.config=function(t){t.debug&&(T.data={cmps:l,waitingSubscribers:f,events:y}),h.threshold=t.threshold||0,h.combo=t.combo},T.fn=function(t,e){if(!p.includes(t))return this;var n=i.prototype;if(_(e))n[t]=function(){return e.apply(this,arguments)};else if(b(e)){var o=n[o];n[t]=o?Object.assign(o,e):e}};var F=Object.freeze({throttle:o}),R=function(t,e,n){return window[n?"renderString":"render"](t,e)},k=window.$||window.jQuery,O=document,E=O.head||O.getElementsByTagName("head")[0]||O.documentElement,A=E.getElementsByTagName("base")[0],I=+navigator.userAgent.replace(/.*(?:AppleWebKit|AndroidWebKit)\/?(\d+).*/i,"$1")<536,L=window.$;T.fn("util",F),T.fn("$",r),T.fn("tpl",R),T.fn("http",c),k(function(){u()&&l.__env__.pub("ready")});var D=k(document),z=k(window).on("load",function(){return u()&&l.__env__.pub("onLoad")}).on("resize",o(function(){return u()&&l.__env__.pub("onResize",[z.width(),z.height(),D.width(),D.height()])},300)).on("scroll",o(function(){return u()&&l.__env__.pub("onScroll",[z.scrollTop(),z.scrollLeft()])},300)).on("beforeunload",function(t){return l.__env__.pub("beforeLeave",t)})}();